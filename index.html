<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EHR System - Bright Edition</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- COLOR PALETTE (BRIGHT & VIBRANT) --- */
            /* Menggunakan gradasi Biru Langit ke Cyan cerah */
            --sidebar-grad: linear-gradient(160deg, #0ea5e9 0%, #0284c7 100%);
            --sidebar-text: #e0f2fe;
            --sidebar-active-bg: #ffffff; 
            --sidebar-active-text: #0284c7;
            
            --bg-main: #f0f9ff;        /* Background Biru Sangat Muda (Alice Blue) */
            --card-bg: #ffffff;
            
            --primary: #0c4a6e;        /* Text Navy Gelap untuk kontras */
            --accent: #06b6d4;         /* Cyan Cerah untuk tombol/highlight */
            
            /* Warna Kartu Statistik (Vibrant) */
            --card-resume: #38bdf8;    /* Sky Blue */
            --card-diag: #818cf8;      /* Indigo */
            --card-tind: #34d399;      /* Emerald */
            --card-obat: #fbbf24;      /* Amber */

            --radius: 16px;
            --shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.15), 0 8px 10px -6px rgba(14, 165, 233, 0.1);
            
            --login-photo: url("https://cdn-cms.pgimgs.com/areainsider/2022/11/Alt-Text-6.-Universitas-di-Bekasi-Universitas-Esa-Unggul--738x424.png");
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-main);
            color: var(--primary);
            height: 100vh;
            overflow: hidden; 
        }

        /* --- LOGIN PAGE (BRIGHT THEME) --- */
        #loginPage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        }
        
        .auth-card {
            width: 950px; max-width: 90%; display: flex; 
            border-radius: 24px; overflow: hidden; 
            box-shadow: 0 25px 50px -12px rgba(2, 132, 199, 0.25);
            background: white; min-height: 550px;
        }

        .auth-left {
            width: 50%; padding: 60px; color: #fff;
            /* Gambar Universitas dengan overlay Biru Cerah */
            background-image: linear-gradient(rgba(14, 165, 233, 0.85), rgba(2, 132, 199, 0.85)), var(--login-photo);
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .auth-right {
            width: 50%; background: white; padding: 60px; 
            display: flex; align-items: center; flex-direction: column; justify-content: center;
        }

        .auth-right h2 { color: var(--primary); margin-bottom: 25px; font-size: 2rem; }
        
        .auth-right input {
            width: 100%; padding: 16px; margin-bottom: 20px; 
            border: 2px solid #e0f2fe; border-radius: 12px; 
            font-size: 1rem; transition: 0.3s; background: #f0f9ff;
        }
        
        .auth-right input:focus {
            border-color: var(--accent); background: white;
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.15);
        }

        .auth-right button {
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            background: linear-gradient(to right, #0ea5e9, #06b6d4); 
            color: white; font-weight: 800; cursor: pointer; transition: 0.3s;
            font-size: 1rem; margin-top: 10px; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
        }

        .auth-right button:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(14, 165, 233, 0.5); }

        /* --- LAYOUT UTAMA --- */
        .app-container { display: flex; height: 100vh; }

        /* SIDEBAR (GRADIENT CERAH) */
        .sidebar {
            width: 270px; background: var(--sidebar-grad); color: var(--sidebar-text);
            display: flex; flex-direction: column; flex-shrink: 0;
            box-shadow: 5px 0 25px rgba(14, 165, 233, 0.15); z-index: 20;
        }
        .sidebar-header {
            height: 90px; display: flex; align-items: center; padding: 0 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2); color: white; gap: 12px; font-weight: 800; font-size: 1.3rem;
        }
        .sidebar-menu { flex: 1; padding: 30px 0; overflow-y: auto; }
        .menu-label {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px;
            padding: 0 30px; margin-bottom: 12px; margin-top: 25px; opacity: 0.9; font-weight: 700; color: #bae6fd;
        }
        .nav-item {
            display: flex; align-items: center; gap: 15px;
            padding: 14px 30px; cursor: pointer; transition: all 0.3s;
            font-size: 0.95rem; font-weight: 600; color: white; opacity: 0.9;
        }
        .nav-item:hover { opacity: 1; background: rgba(255,255,255,0.15); padding-left: 35px; }
        .nav-item.active {
            background: var(--sidebar-active-bg); color: var(--sidebar-active-text);
            margin: 0 15px; border-radius: 12px; opacity: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* MAIN CONTENT */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        .top-header {
            height: 90px; background: white; display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; border-bottom: 1px solid #e0f2fe;
        }
        .scroll-area { flex: 1; overflow-y: auto; padding: 40px; }

        /* --- DASHBOARD WIDGETS --- */
        .welcome-banner {
            background: white; border-radius: var(--radius); padding: 30px 40px;
            margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;
            border-left: 8px solid var(--accent); box-shadow: var(--shadow);
            background-image: linear-gradient(to right, #fff, #f0f9ff);
        }
        .welcome-text h1 { margin: 0 0 8px 0; font-size: 1.8rem; color: #0284c7; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-bottom: 40px; }
        .stat-card {
            background: white; border-radius: var(--radius); padding: 25px;
            box-shadow: var(--shadow); border: 1px solid #e0f2fe; position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;
        }
        .stat-card:hover { transform: translateY(-8px); box-shadow: 0 20px 30px -10px rgba(14, 165, 233, 0.2); }
        .stat-value { font-size: 2.5rem; font-weight: 800; margin: 10px 0; color: #0f172a; }
        .stat-label { font-size: 0.85rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-icon { position: absolute; right: 25px; top: 25px; font-size: 2rem; opacity: 0.15; }

        /* --- FORMS & TABLES --- */
        .card {
            background: white; border-radius: var(--radius);
            box-shadow: var(--shadow); padding: 35px; margin-bottom: 35px; border: 1px solid #e0f2fe;
        }
        .card h3 { margin-top: 0; color: #0369a1; display: flex; align-items: center; gap: 12px; font-size: 1.3rem; }

        input, select, textarea {
            width: 100%; padding: 15px; border: 2px solid #e0f2fe;
            border-radius: 12px; font-family: inherit; font-size: 0.95rem; 
            margin-bottom: 15px; background: #f8fafc; transition: 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            background: white; border-color: var(--accent); 
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.1);
        }
        label { font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block; color: #475569; }

        .btn {
            padding: 14px 28px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px; font-size: 1rem; transition: 0.3s;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #0ea5e9, #0284c7); 
            color: white; 
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.3); 
        }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(2, 132, 199, 0.4); }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 15px; }
        th { background: #f0f9ff; padding: 18px; text-align: left; font-size: 0.85rem; color: #0369a1; font-weight: 800; text-transform: uppercase; border-bottom: 2px solid #bae6fd; }
        td { padding: 18px; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; color: #334155; }
        
        .badge { padding: 6px 14px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; background: #e0f2fe; color: #0284c7; border: 1px solid #bae6fd; }
        .badge-sec { background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; }

        /* AUTOCOMPLETE */
        .suggestions-box {
            position: absolute; background: white; width: 100%; max-height: 250px;
            overflow-y: auto; box-shadow: 0 15px 30px rgba(0,0,0,0.1); 
            border-radius: 12px; z-index: 100; border: 1px solid #e2e8f0; margin-top: -5px;
        }
        .suggestion-item { padding: 14px 18px; cursor: pointer; border-bottom: 1px solid #f1f5f9; }
        .suggestion-item:hover { background: #f0f9ff; color: #0284c7; }

        /* TABS */
        .tab-btn { padding: 12px 24px; border: 1px solid #e0f2fe; background: white; border-radius: 10px; cursor: pointer; font-weight: 700; color: #64748b; margin-right: 8px; transition: 0.3s; }
        .tab-btn.active { background: #0ea5e9; color: white; border-color: #0ea5e9; box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3); }

        .section-content { display: none; animation: fadeIn 0.4s ease; }
        .section-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="auth-card">
        <div class="auth-left">
            <h1 style="font-size: 3rem; margin-bottom: 10px;"><i class="fas fa-hospital-user"></i></h1>
            <h2 style="margin: 0; font-size: 2rem;">E-MEDIS</h2>
            <p style="opacity: 0.9; font-size: 1.1rem; margin-top: 10px;">Sistem Rekam Medis Elektronik</p>
            <div style="margin-top:auto; font-size:0.9rem; opacity:0.8; font-weight:600;"><i class="fas fa-university"></i> Universitas Esa Unggul</div>
        </div>
        <div class="auth-right">
            <div style="width:100%">
                <h2 style="margin-bottom: 30px; color: var(--primary); text-align:center;">Login Admin</h2>
                <label>ID Pengguna</label>
                <input type="text" id="username" placeholder="Masukkan Username">
                
                <label>Kata Sandi</label>
                <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                
                <button onclick="login()">MASUK SISTEM</button>
            </div>
        </div>
    </div>
</div>

<div class="app-container" id="mainApp" style="display:none">
    
    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-heartbeat" style="font-size:1.8rem; margin-right:10px;"></i>
            <span>E-MEDIS </span>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-label">Menu Utama</div>
            <a class="nav-item active" onclick="navTo('dashboard')" id="nav-dashboard">
                <i class="fas fa-chart-pie"></i> Dashboard
            </a>
            <a class="nav-item" onclick="navTo('input')" id="nav-input">
                <i class="fas fa-file-medical-alt"></i> Input Resume
            </a>
            
            <div class="menu-label">Master Data</div>
            <a class="nav-item" onclick="navTo('add-code')" id="nav-add-code">
                <i class="fas fa-folder-plus"></i> Tambah Kode
            </a>
            <a class="nav-item" onclick="navTo('database')" id="nav-database">
                <i class="fas fa-database"></i> Database Klinis
            </a>
            <a class="nav-item" onclick="navTo('search')" id="nav-search">
                <i class="fas fa-search"></i> Kamus Kode
            </a>
        </div>

        <div style="padding: 30px;">
            <button onclick="logout()" class="btn" style="width:100%; background:rgba(255,255,255,0.2); color:white; border:1px solid rgba(255,255,255,0.2);">
                <i class="fas fa-sign-out-alt"></i> Keluar
            </button>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-header">
            <div>
                <h2 id="page-title" style="margin:0; font-size:1.4rem; color:var(--primary);">Dashboard Overview</h2>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="text-align:right;">
                    <div style="font-weight:800; font-size:0.95rem; color:#0f172a;">Administrator</div>
                    <div style="font-size:0.8rem; color:#64748b;">Unit Rekam Medis</div>
                </div>
                <div style="width:45px; height:45px; background:#e0f2fe; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--accent);">
                    <i class="fas fa-user-circle" style="font-size:1.8rem"></i>
                </div>
            </div>
        </header>

        <div class="scroll-area">
            
            <div id="section-dashboard" class="section-content active">
                <div class="welcome-banner">
                    <div class="welcome-text">
                        <h1>Hi, Admin! ðŸ‘‹</h1>
                        <p>Selamat bertugas. Berikut ringkasan aktivitas hari ini.</p>
                    </div>
                    <div style="text-align:right;">
                        <div id="clock" style="font-size:2.2rem; font-weight:800; color:#0284c7;">00:00</div>
                        <div id="date-display" style="font-size:0.9rem; color:#64748b; font-weight:600;">Senin, 1 Januari</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" style="border-left: 6px solid var(--card-resume);">
                        <div class="stat-label" style="color:var(--card-resume)">Total Pasien</div>
                        <div class="stat-value" id="stat-total">0</div>
                        <i class="fas fa-users stat-icon" style="color:var(--card-resume)"></i>
                    </div>
                    <div class="stat-card clickable" onclick="goToDatabase('diagnosis')" style="border-left: 6px solid var(--card-diag);">
                        <div class="stat-label" style="color:var(--card-diag)">Data Diagnosis</div>
                        <div class="stat-value" id="stat-diag">0</div>
                        <i class="fas fa-stethoscope stat-icon" style="color:var(--card-diag)"></i>
                    </div>
                    <div class="stat-card clickable" onclick="goToDatabase('tindakan')" style="border-left: 6px solid var(--card-tind);">
                        <div class="stat-label" style="color:var(--card-tind)">Data Tindakan</div>
                        <div class="stat-value" id="stat-tind">0</div>
                        <i class="fas fa-procedures stat-icon" style="color:var(--card-tind)"></i>
                    </div>
                    <div class="stat-card clickable" onclick="goToDatabase('obat')" style="border-left: 6px solid var(--card-obat);">
                        <div class="stat-label" style="color:var(--card-obat)">Data Obat</div>
                        <div class="stat-value" id="stat-obat">0</div>
                        <i class="fas fa-pills stat-icon" style="color:var(--card-obat)"></i>
                    </div>
                </div>

                <div class="card">
                    <h3><i class="fas fa-history"></i> Riwayat Input Terakhir</h3>
                    <div style="overflow-x:auto">
                        <table>
                            <thead>
                                <tr><th>No. RM</th><th>Nama Pasien</th><th>Diagnosis Utama</th><th>Diagnosis Sekunder</th><th>Aksi</th></tr>
                            </thead>
                            <tbody id="recent-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="section-input" class="section-content">
                <div class="card" style="max-width: 900px; margin: auto;">
                    <h3><i class="fas fa-edit"></i> Input Resume Medis</h3>
                    <form id="form-resume">
                        <div style="display:grid; grid-template-columns:1fr 2fr; gap:25px; margin-bottom:10px;">
                            <div><label>Nomor RM</label><input id="nomor-rm" placeholder="Contoh: RM-2024-001" required></div>
                            <div><label>Nama Lengkap</label><input id="nama-pasien" required></div>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:25px; margin-bottom:10px;">
                            <div><label>Tanggal Lahir</label><input type="date" id="tgl-lahir" required></div>
                            <div>
                                <label>Gender</label>
                                <select id="gender" required>
                                    <option value="">Pilih...</option>
                                    <option>Laki-laki</option>
                                    <option>Perempuan</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="background:#f0f9ff; padding:25px; border-radius:16px; border:2px solid #e0f2fe; margin-bottom:25px;">
                            <h4 style="margin:0 0 20px 0; color:#0284c7; display:flex; align-items:center; gap:10px;">
                                <i class="fas fa-file-medical-alt"></i> Data Diagnosis
                            </h4>
                            
                            <div style="position:relative; margin-bottom:25px;">
                                <label style="color:#0369a1">Diagnosis Utama (Primary)</label>
                                <input id="diag-utama-search" placeholder="Ketik nama penyakit (contoh: tifus, demam)..." autocomplete="off" style="border-color:#38bdf8; background:white;">
                                <div id="diag-utama-results" class="suggestions-box" style="display:none"></div>
                            </div>

                            <div style="position:relative;">
                                <label style="color:#64748b">Diagnosis Sekunder (Optional)</label>
                                <input id="diag-sekunder-search" placeholder="Ketik diagnosis penyerta..." autocomplete="off">
                                <div id="diag-sekunder-results" class="suggestions-box" style="display:none"></div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width:100%"><i class="fas fa-save"></i> SIMPAN DATA REKAM MEDIS</button>
                    </form>
                </div>
            </div>

            <div id="section-add-code" class="section-content">
                <div class="card" style="max-width: 700px; margin: 0 auto;">
                    <h3><i class="fas fa-plus-circle"></i> Tambah Referensi Baru</h3>
                    <div style="background:#e0f2fe; padding:20px; border-radius:12px; border:1px solid #bae6fd; margin-bottom:25px; font-size:0.95rem; color:#0369a1;">
                        <i class="fas fa-info-circle"></i> Gunakan fitur ini jika kode medis tidak ditemukan di database.
                    </div>
                    <form id="form-add-code">
                        <label>Kategori</label>
                        <select id="new-category" required>
                            <option value="diagnosis">Diagnosis</option>
                            <option value="tindakan">Tindakan</option>
                            <option value="obat">Obat & Alkes</option>
                        </select>
                        <label>Nama Term/Istilah</label>
                        <input id="new-term" placeholder="Nama Penyakit/Obat" required>
                        <label>Kode ID</label>
                        <input id="new-code" placeholder="Kode Numerik" required>
                        <label>Deskripsi</label>
                        <textarea id="new-desc" rows="2" required></textarea>
                        <button type="submit" class="btn btn-primary" style="width:100%"><i class="fas fa-check-circle"></i> TAMBAH KE DATABASE</button>
                    </form>
                </div>
            </div>

            <div id="section-database" class="section-content">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                        <h3><i class="fas fa-database"></i> Database Referensi</h3>
                        <div style="display:flex; gap:10px;">
                            <button class="tab-btn active" id="tab-diag" onclick="switchTab('diagnosis')">Diagnosis</button>
                            <button class="tab-btn" id="tab-tind" onclick="switchTab('tindakan')">Tindakan</button>
                            <button class="tab-btn" id="tab-obat" onclick="switchTab('obat')">Obat</button>
                        </div>
                    </div>
                    <div style="overflow-x:auto; max-height: 600px;">
                        <table id="db-table">
                            <thead>
                                <tr><th>Term/Istilah</th><th>Kode ID</th><th>Deskripsi</th></tr>
                            </thead>
                            <tbody id="db-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="section-search" class="section-content">
                <div class="card">
                    <h3><i class="fas fa-search"></i> Pencarian Global</h3>
                    <input id="search-box" style="padding:18px; font-size:1.1rem; border-radius:50px; text-align:center" placeholder="Cari apapun disini..." onkeyup="globalSearch()">
                    <div id="global-results" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px; margin-top:30px;"></div>
                </div>
            </div>

        </div>
    </main>
</div>

<script>
// --- DATABASE LENGKAP ---
const defaultDiagnosis = [
  { term: 'Hidung kiri tersumbat', code: '68235000', description: 'Nasal congestion (finding)' },
  { term: 'Malignant neoplasm, accessory sinus, unspecified', code: '39659005', description: 'Primary malignant neoplasm of accessory sinus (disorder)' },
  { term: 'Malignant neoplasm of colon, unspecified', code: '363406005', description: 'Malignant neoplasm of colon (disorder)' },
  { term: 'Adenocarcinoma of colon', code: '1701000119104', description: 'Primary adenocarcinoma of colon (disorder)' },
  { term: 'Adenocarcinoma NOS', code: '1187332001', description: 'Adenocarcinoma (morphologic abnormality)' },
  { term: 'Adenocarcinoma NOS', code: '1187332001', description: 'Adenocarcinoma (morphologic abnormality)' },
  { term: 'Anemia', code: '703135009', description: 'Anemia in malignant neoplastic disease (disorder)' },
  { term: 'Anemia', code: '703135009', description: 'History of anemia (situation)' },
  { term: 'Anemia aplastik', code: '106959006', description: 'Aplastic anemia (disorder)' },
  { term: 'Anemia aplastik', code: '106950006', description: 'Aplastic anemia (disorder)' },
  { term: 'Ischemic heart disease', code: '414545008', description: 'Ischemic heart disease (disorder)' },
  { term: 'Ischemic heart disease', code: '414545008', description: 'Ischemic heart disease disorder (disorder)' },
  { term: 'Angina pectoris', code: '194828000', description: 'Angina (disorder)' },
  { term: 'Complicated cataract', code: '193600001', description: 'Cataract due to ocular disease (disorder)' },
  { term: 'Iridocyclitis, unspecified', code: '77971008', description: 'Iridocyclitis (disorder)' },
  { term: 'Megacolon congenital post', code: '24291004', description: 'Congenital dilatation of colon (disorder)' },
  { term: 'Hirschsprungâ€™s disease', code: '204739008', description: 'Congenital aganglionic megacolon (disorder)' },
  { term: 'Transitional cell carcinoma BLADDER', code: '255109008', description: 'Transitional cell carcinoma of urinary bladder (disorder)' },
  { term: 'Bladder, unspecified', code: '93689003', description: 'Primary malignant neoplasm of urinary bladder (disorder)' },
  { term: 'Malignant neoplasm bladder, unspecified', code: '93689003', description: 'Primary malignant neoplasm of urinary bladder (disorder)' },
  { term: 'Transitional cell carcinoma NOS', code: '27990000', description: 'Transitional cell carcinoma (morphologic abnormality)' },
  { term: 'Pusing', code: '404640003', description: 'Dizziness (finding)' },
  { term: 'Badan Pegal', code: '82991004', description: 'Generalized aches and pains (finding)' },
  { term: 'Keseumutan', code: '95668009', description: 'Paresthesia (finding)' },
  { term: 'Batuk', code: '49727002', description: 'Cough (finding)' },
  { term: 'Mual', code: '422587007', description: 'Nausea (finding)' },
  { term: 'Chill', code: '43724002', description: 'Chill (finding)' },
  { term: 'Fever', code: '386661006', description: 'Fever (finding)' },
  { term: 'Kondisi pasien membaik', code: '268910001', description: 'Patientâ€™s condition improved (finding)' },
  { term: 'Membaik', code: '268910001', description: "Patient's condition improved (finding)" },
  { term: 'Benjolan di telinga', code: '300850006', description: 'Mass of ear structure (finding)' },
  { term: 'Benjolan di telinga terasa tertusuk-tusuk', code: '300850006', description: 'Mass of ear structure (finding)' },
  { term: 'Telinga (benjolan)', code: '300850006', description: 'Mass of ear structure (finding)' },
  { term: 'Pandangan kabur', code: '111516008', description: 'Blurring of visual image (finding)' },
  { term: 'Pendengaran berkurang', code: '15188001', description: 'Hearing loss (disorder)' },
  { term: 'Badan lemas', code: '13791008', description: 'Asthenia (finding)' },
  { term: 'Lemas', code: '13791008', description: 'Asthenia (finding)' },
  { term: 'Demam naik turun', code: '77957000', description: 'Intermittent fever (finding)' },
  { term: 'Kurang nafsu makan', code: '79990006', description: 'Loss of appetite (finding)' },
  { term: 'Kurang nafsu makan', code: '79890006', description: 'Loss of appetite (finding)' },
  { term: 'Kurang nafsu makan', code: '79890006', description: 'Loss of appetite (finding)' },
  { term: 'Loss of appetite', code: '79990006', description: 'Loss of appetite (finding)' },
  { term: 'Middle-age', code: '282895005', description: 'Middle-age (finding)' },
  { term: '55 tahun', code: '282895005', description: 'Middle-age (finding)' },
  { term: '62 tahun', code: '105407002', description: 'Elderly man (person)' },
  { term: '62 tahun', code: '105437002', description: 'Elderly man (person)' },
  { term: '62 tahun', code: '105438007', description: 'Elderly woman (person)' },
  { term: '75 tahun', code: '424144002', description: 'Elderly person (person)' },
  { term: 'Person categorized by age', code: '105590001', description: 'Person categorized by age (person)' },
  { term: 'Laki-laki', code: '394733009', description: 'Man (person)' },
  { term: 'Laki-laki', code: '339947000', description: 'Man (person)' },
  { term: 'Male', code: '394733009', description: 'Man (person)' },
  { term: 'Laki-laki', code: '394733009', description: 'Man (person)' },
  { term: 'Perempuan', code: '22456002', description: 'Woman (person)' },
  { term: 'Perempuan', code: '248152002', description: 'Female (person)' },
  { term: 'Perempuan', code: '248152002', description: 'Female (person)' },
  { term: 'Person categorized by age', code: '105590001', description: 'Person categorized by age (person)' },
  { term: 'Middle-age', code: '282895005', description: 'Middle-age (finding)' },
  { term: 'Fully conscious', code: '271591004', description: 'Fully conscious (finding)' },
  { term: 'Fully conscious', code: '271591004', description: 'Fully conscious (finding)' },
  { term: 'EWS hijau', code: '445193007', description: 'Early warning scoring system (assessment scale)' },
  { term: 'Risiko jatuh rendah', code: '439430008', description: 'At low risk for fall (finding)' },
  { term: 'PPS 70%', code: '373801008', description: 'World Health Organization performance status scale (assessment scale)' },
  { term: 'ADL dibantu keluarga', code: '304492001', description: 'Activity of daily living assistance (procedure)' },
  { term: 'History of diabetes mellitus', code: '161445003', description: 'History of diabetes mellitus (situation)' },
  { term: 'History of chronic lymphocytic leukemia', code: '635800011004', description: 'History of chronic lymphocytic leukemia (situation)' },
  { term: 'Diabetes mellitus type 2', code: '44054006', description: 'Diabetes mellitus type 2 (disorder)' },
  { term: 'Chronic lymphoid leukemia', code: '92814006', description: 'Chronic lymphoid leukemia (disorder)' }
];

const defaultTindakan = [
  { term: 'Kontrol CA Sinonasal ADS', code: '281036007', description: 'Follow-up consultation (procedure)' },
  { term: 'Tensi 120/80 mmHg', code: '75367002', description: 'Blood pressure (observable entity)' },
  { term: 'Tensi 130/81 mmHg', code: '75367002', description: 'Blood pressure (observable entity)' },
  { term: 'Tensi 127/75 mmHg', code: '75367002', description: 'Blood pressure (observable entity)' },
  { term: 'Nadi 80 x/menit', code: '78564009', description: 'Heart rate (observable entity)' },
  { term: 'Nadi 107 x/menit', code: '78564009', description: 'Heart rate (observable entity)' },
  { term: 'Nadi 130 / menit', code: '78564009', description: 'Heart rate (observable entity)' },
  { term: 'Suhu 36.00 C', code: '703421000', description: 'Temperature (observable entity)' },
  { term: 'Suhu 36.20 C', code: '703421000', description: 'Temperature (observable entity)' },
  { term: 'Suhu 36.60 C', code: '703421000', description: 'Temperature (observable entity)' },
  { term: 'Suhu 36.5 C', code: '703421000', description: 'Temperature (observable entity)' },
  { term: 'BB 60.0 Kg', code: '27113001', description: 'Body weight (observable entity)' },
  { term: 'BB 52.0 Kg', code: '27113001', description: 'Body weight (observable entity)' },
  { term: 'BB 3.6 Kg', code: '27113001', description: 'Body weight (observable entity)' },
  { term: 'TB 165 cm', code: '1153637007', description: 'Body height (observable entity)' },
  { term: 'TB 160 cm', code: '1153637007', description: 'Body height (observable entity)' },
  { term: 'TB 155 cm', code: '1153637007', description: 'Body height (observable entity)' },
  { term: 'TB 52 Cm', code: '1153637007', description: 'Body height (observable entity)' },
  { term: 'RR 21 x/menit', code: '86290005', description: 'Respiratory rate (observable entity)' },
  { term: 'RR 20 x/menit', code: '86290005', description: 'Respiratory rate (observable entity)' },
  { term: 'RR 26 / menit', code: '86290005', description: 'Respiratory rate (observable entity)' },
  { term: 'Medikamentosa', code: '18629005', description: 'Drug administration (procedure)' },
  { term: 'Radiotherapy', code: '1287742003', description: 'Radiotherapy (procedure)' },
  { term: 'Radiotherapy session', code: '122255006', description: 'Radiotherapy treatment phase (procedure)' },
  { term: 'Kemoterapi siklus 1', code: '399042005', description: 'Chemotherapy cycle (procedure)' },
  { term: 'Kemoterapi', code: '367336001', description: 'Chemotherapy (procedure)' },
  { term: 'Bone marrow aspiration', code: '49041003', description: 'Bone marrow aspiration (procedure)' },
  { term: 'Random blood glucose measurement', code: '271061004', description: 'Random blood glucose measurement (procedure)' },
  { term: 'Glucose tolerance test', code: '113807002', description: 'Glucose tolerance test (procedure)' },
  { term: 'Lab darah lengkap', code: '266407004', description: 'Complete blood count (procedure)' },
  { term: 'Kimia klinik', code: '35248006', description: 'Chemical method (procedure)' },
  { term: 'Terapi obat', code: '416608005', description: 'Drug therapy (procedure)' },
  { term: 'Transfusi', code: '82299001', description: 'Blood transfusion (procedure)' },
  { term: 'Transfusi PRC', code: '71498003', description: 'Packed red cell transfusion (procedure)' },
  { term: 'Injection or infusion of cancer chemotherapeutic substance', code: '38216008', description: 'Cancer chemotherapy infusion (procedure)' },
  { term: 'Injection of chemotherapeutic substance into subcutaneous reservoir', code: '230857009', description: 'Chemotherapy injection (procedure)' },
  { term: 'Aspiration needle', code: '706851000', description: 'Aspiration needle (procedure)' }
];

const defaultObat = [
  { term: 'NACL Satoria Infus 0,9% 500 mL', code: '782104005', description: 'Sodium chloride 0.9% infusion (clinical drug)' },
  { term: 'NaCl 0.9% 500 mL', code: '782104005', description: 'Sodium chloride 0.9% infusion (clinical drug)' },
  { term: 'OTSUI NACL infus 0,9%', code: '395083000', description: 'Sodium chloride solution (clinical drug)' },
  { term: 'Aspirin', code: '387458008', description: 'Aspirin (clinical drug)' },
  { term: 'Clopidogrel tablet 75 mg', code: '783048008', description: 'Clopidogrel 75 mg tablet (clinical drug)' },
  { term: 'Bisoprolol tablet 5 mg', code: '373444002', description: 'Bisoprolol 5 mg tablet (clinical drug)' },
  { term: 'Atorvastatin tablet 20 mg', code: '373444002', description: 'Atorvastatin 20 mg tablet (clinical drug)' },
  { term: 'Amlodipine tablet 10 mg', code: '783048008', description: 'Amlodipine 10 mg tablet (clinical drug)' },
  { term: 'Metformin tablet', code: '372567009', description: 'Metformin (clinical drug)' },
  { term: 'Omeprazole capsule 20 mg', code: '317291008', description: 'Omeprazole 20 mg capsule (clinical drug)' },
  { term: 'Ondansetron inj 2 mg/mL', code: '782032003', description: 'Ondansetron injection (clinical drug)' },
  { term: 'Ondansetron tablet 4 mg', code: '322173001', description: 'Ondansetron 4 mg tablet (clinical drug)' },
  { term: 'Ondansetron tablet 8 mg', code: '322173001', description: 'Ondansetron 8 mg tablet (clinical drug)' },
  { term: 'Paracetamol infus 10 mg/mL', code: '123715007', description: 'Paracetamol infusion (clinical drug)' },
  { term: 'Paracetamol tablet 500 mg', code: '322236009', description: 'Paracetamol 500 mg tablet (clinical drug)' },
  { term: 'Corsotablet 4 mg', code: '376880006', description: 'Dexamethasone 4 mg tablet (clinical drug)' },
  { term: 'Deksametason inj 5 mg', code: '372584003', description: 'Dexamethasone injection 5 mg (clinical drug)' },
  { term: 'Diazepam tablet 2 mg', code: '32119004', description: 'Diazepam 2 mg tablet (clinical drug)' },
  { term: 'Ranitidin inj 25 mg/mL', code: '782087002', description: 'Ranitidine injection (clinical drug)' },
  { term: 'Tramadol inj 50 mg/mL', code: '782123003', description: 'Tramadol injection (clinical drug)' },
  { term: 'Sefiksim kapsul 100 mg', code: '387536009', description: 'Cefixime 100 mg capsule (clinical drug)' },
  { term: 'Sefotaksim inj 1 g', code: '321985003', description: 'Cefotaxime 1 g injection (clinical drug)' },
  { term: 'Spironolakton tablet 25 mg', code: '318056008', description: 'Spironolactone 25 mg tablet (clinical drug)' },
  { term: 'Spironolacton tablet 25 mg', code: '318065006', description: 'Spironolactone 25 mg tablet (clinical drug)' },
  { term: 'KCl 7.46% 25 mL', code: '1204388008', description: 'Potassium chloride injection (clinical drug)' },
  { term: 'MgSO4 40% 25 mL', code: '387202002', description: 'Magnesium sulfate (clinical drug)' },
  { term: 'Vitamin B kompleks tablet', code: '103096003', description: 'Vitamin B complex (medicinal product)' },
  { term: 'Vitamin C tablet 250 mg', code: '43706004', description: 'Ascorbic acid 250 mg tablet (medicinal product)' },
  { term: 'SPET 20 CC', code: '61968008', description: 'Syringe (physical object)' },
  { term: 'Spet 10 cc', code: '61968008', description: 'Syringe (physical object)' },
  { term: 'Spet 3 cc', code: '61968008', description: 'Syringe (physical object)' },
  { term: 'Spet 5 cc', code: '61968008', description: 'Syringe (physical object)' },
  { term: 'IV Catheter No.20', code: '82449006', description: 'Peripheral IV catheter (physical object)' },
  { term: 'IV Catheter No.22', code: '82449006', description: 'Peripheral IV catheter (physical object)' },
  { term: 'IV Catheter No.24', code: '82449006', description: 'Peripheral IV catheter (physical object)' },
  { term: 'IV catheter', code: '82449006', description: 'Peripheral IV catheter (physical object)' },
  { term: '3-way stopcock', code: '466146004', description: 'Stopcock (physical object)' },
  { term: '3-way stopcock (Tro Venoflow)', code: '469551002', description: 'Intravenous line stopcock (physical object)' },
  { term: 'Transparent IV dressing', code: '336253001', description: 'Needleless IV catheter holder (physical object)' },
  { term: 'Transfusion set', code: '466245002', description: 'Blood transfusion filter (device)' },
  { term: 'Blood bag', code: '116205004', description: 'Blood bag device (physical object)' },
  { term: 'Tas purinya kecil UK 34CM X 25CM X 5CM', code: '116205004', description: 'Blood bag device (physical object)' },
  { term: 'Tas puring ledl 34 cm x 35 cm x 38 cm', code: '110265004', description: 'Blood bag device (physical object)' },
  { term: 'Aspiration needle', code: '706851000', description: 'Aspiration needle device (physical object)' },
  { term: 'Insulin syringe', code: '426602009', description: 'Insulin syringe device (physical object)' },
  { term: 'Gauze roll', code: '40187005', description: 'Sterile gauze roll (physical object)' },
  { term: 'Gauze roll', code: '40187005', description: 'Gauze roll, sterile (physical object)' },
  { term: 'Steriflo humidifier disposable 350 mL', code: '1351734003', description: 'Humidifier device (physical object)' },
  { term: 'Suction catheter no. 12', code: '58253008', description: 'Suction catheter device (physical object)' },
  { term: 'Selang Oâ‚‚ dewasa', code: '336623009', description: 'Oxygen nasal cannula (physical object)' }
];


// --- LOGIC ---
let dataDiagnosis = JSON.parse(localStorage.getItem('db_diagnosis')) || defaultDiagnosis;
let dataTindakan = JSON.parse(localStorage.getItem('db_tindakan')) || defaultTindakan;
let dataObat = JSON.parse(localStorage.getItem('db_obat')) || defaultObat;
let databasePasien = JSON.parse(localStorage.getItem('pasienData')) || [];

function saveDB() {
    localStorage.setItem('db_diagnosis', JSON.stringify(dataDiagnosis));
    localStorage.setItem('db_tindakan', JSON.stringify(dataTindakan));
    localStorage.setItem('db_obat', JSON.stringify(dataObat));
}

// Jam
setInterval(() => {
    const now = new Date();
    document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
    document.getElementById('date-display').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
}, 1000);

// Login
function login() {
    if(document.getElementById('username').value.trim() !== "") {
        document.getElementById('loginPage').style.display = "none";
        document.getElementById('mainApp').style.display = "flex";
        updateStats();
    }
}
function logout() { location.reload(); }

// Navigasi
function navTo(pageId) {
    document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.getElementById(`section-${pageId}`).classList.add('active');
    document.getElementById(`nav-${pageId}`).classList.add('active');
    
    const titles = { 'dashboard':'Dashboard Overview', 'input':'Input Resume Medis', 'add-code':'Tambah Kode Baru', 'database':'Database Klinis', 'search':'Pencarian Global' };
    document.getElementById('page-title').innerText = titles[pageId];

    if(pageId === 'database') switchTab('diagnosis');
}

function goToDatabase(tab) {
    navTo('database');
    switchTab(tab);
}

function updateStats() {
    document.getElementById('stat-total').innerText = databasePasien.length;
    document.getElementById('stat-diag').innerText = dataDiagnosis.length;
    document.getElementById('stat-tind').innerText = dataTindakan.length;
    document.getElementById('stat-obat').innerText = dataObat.length;

    const tbody = document.getElementById('recent-body');
    if(databasePasien.length === 0) tbody.innerHTML = "<tr><td colspan='5' align='center' style='padding:30px; color:#aaa'>Belum ada data pasien</td></tr>";
    else {
        tbody.innerHTML = databasePasien.slice().reverse().map(p => `
            <tr>
                <td><strong>${p.rm}</strong></td>
                <td>${p.nama}</td>
                <td><span class="badge">${p.diagnosaUtama || '-'}</span></td>
                <td><span class="badge badge-sec">${p.diagnosaSekunder || '-'}</span></td>
                <td><button onclick="hapusPasien(${p.id})" style="background:#fee2e2; color:red; border:none; padding:5px 10px; border-radius:8px; cursor:pointer"><i class="fas fa-trash"></i></button></td>
            </tr>
        `).join('');
    }
}

// --- FUNGSI AUTOCOMPLETE REUSABLE (UTAMA & SEKUNDER) ---
function setupAutocomplete(inputId, resultId) {
    const input = document.getElementById(inputId);
    const results = document.getElementById(resultId);
    
    input.addEventListener('input', function() {
        const val = this.value.toLowerCase();
        results.innerHTML = '';
        if(!val) { results.style.display = 'none'; return; }
        
        const filter = dataDiagnosis.filter(d => d.term.toLowerCase().includes(val));
        
        if(filter.length > 0) {
            results.style.display = 'block';
            filter.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.innerHTML = `<strong>${item.term}</strong> <small style="color:var(--accent)">[${item.code}]</small>`;
                div.onclick = () => {
                    input.value = item.term;
                    results.style.display = 'none';
                };
                results.appendChild(div);
            });
        } else {
            results.style.display = 'block';
            results.innerHTML = `<div class="suggestion-item" style="color:red">Data tidak ditemukan. <a onclick="navTo('add-code')" style="text-decoration:underline; cursor:pointer">Tambah baru?</a></div>`;
        }
    });

    document.addEventListener('click', function(e) {
        if(e.target !== input) results.style.display = 'none';
    });
}

// Pasang Autocomplete
setupAutocomplete('diag-utama-search', 'diag-utama-results');
setupAutocomplete('diag-sekunder-search', 'diag-sekunder-results');

// SIMPAN RESUME (DENGAN 2 DIAGNOSIS)
document.getElementById('form-resume').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const diagUtama = document.getElementById('diag-utama-search').value;
    const diagSekunder = document.getElementById('diag-sekunder-search').value;

    if(!diagUtama) { alert("Diagnosis Utama wajib diisi!"); return; }

    databasePasien.push({
        id: Date.now(),
        rm: document.getElementById('nomor-rm').value,
        nama: document.getElementById('nama-pasien').value,
        gender: document.getElementById('gender').value,
        diagnosaUtama: diagUtama,
        diagnosaSekunder: diagSekunder || '-' // Jika kosong, isi strip
    });
    
    localStorage.setItem('pasienData', JSON.stringify(databasePasien));
    this.reset();
    alert("Rekam Medis Berhasil Disimpan!");
    navTo('dashboard');
    updateStats();
});

// TAMBAH KODE
document.getElementById('form-add-code').addEventListener('submit', function(e) {
    e.preventDefault();
    const cat = document.getElementById('new-category').value;
    const newItem = {
        term: document.getElementById('new-term').value,
        code: document.getElementById('new-code').value,
        description: document.getElementById('new-desc').value
    };
    if(cat === 'diagnosis') dataDiagnosis.push(newItem);
    else if(cat === 'tindakan') dataTindakan.push(newItem);
    else dataObat.push(newItem);
    saveDB();
    alert("Berhasil ditambahkan!");
    this.reset();
    updateStats();
});

// DATABASE
function switchTab(type) {
    ['diag','tind','obat'].forEach(t => {
        document.getElementById('tab-'+t).className = 'tab-btn';
    });
    const map = {'diagnosis':'diag', 'tindakan':'tind', 'obat':'obat'};
    document.getElementById('tab-'+map[type]).classList.add('active');

    const data = (type === 'diagnosis') ? dataDiagnosis : (type === 'tindakan') ? dataTindakan : dataObat;
    data.sort((a,b) => a.term.localeCompare(b.term));
    
    document.getElementById('db-body').innerHTML = data.map(i => `
        <tr><td><strong>${i.term}</strong></td><td><code style="background:#e0f2fe; color:#0284c7; padding:2px 5px; border-radius:4px">${i.code}</code></td><td>${i.description}</td></tr>
    `).join('');
}

// SEARCH
function globalSearch() {
    const q = document.getElementById('search-box').value.toLowerCase();
    const container = document.getElementById('global-results');
    if(!q) { container.innerHTML=''; return; }
    
    const all = [...dataDiagnosis, ...dataTindakan, ...dataObat];
    const res = all.filter(x => x.term.toLowerCase().includes(q) || x.code.includes(q));
    
    container.innerHTML = res.map(x => `
        <div style="background:white; padding:15px; border-radius:10px; border-left:4px solid var(--accent); box-shadow:0 2px 5px rgba(0,0,0,0.05)">
            <div style="font-weight:bold">${x.term}</div>
            <div style="font-size:0.8rem; color:var(--accent)">ID: ${x.code}</div>
            <div style="font-size:0.8rem; color:#64748b">${x.description}</div>
        </div>
    `).join('');
}

function hapusPasien(id) {
    if(confirm("Hapus data ini?")) {
        databasePasien = databasePasien.filter(p => p.id !== id);
        localStorage.setItem('pasienData', JSON.stringify(databasePasien));
        updateStats();
    }
}
</script>
</body>

</html>
